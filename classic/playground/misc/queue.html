<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Response Queue</title>
  <link rel="stylesheet" href="/playground/assets/styles.css">
  <script type="module">
    import { store, clientPool } from '@dfwc/core';

    // const serverAddress = 'localhost:3000';
    // clientPool.options = {serverAddress};

    const handle = {
      responseChanged(topic, { response }) {
        console.log(`${topic} page: ${response.page}, query_counter: ${response.query_counter}`);
      }
    };

    const context = store.getContext('6a96504dc173514cab1e0198af92e6e9', 'eu1', 'default');
    context.subscribe('response', handle.responseChanged);

    const query = context.newQuery();
    query.searchText('silla');

    let page = 0;
    let timer = null;
    const INTERVAL = 100;

    function search() {
      if (page < 25) {
        context.query.page(++page);
        context.search();
      } else {
        stop();
      }
    }

    function start() {
      if (!timer) {
        timer = setInterval(search, INTERVAL)
      }
    }

    function stop() {
      if (timer) {
        clearInterval(timer);
        timer = null;
      }
      page = 0;
    }

    document.getElementById('start').addEventListener('click', (e) => {
      start();
    });
    document.getElementById('stop').addEventListener('click', (e) => {
      stop();
    });
  </script>
</head>
<body>
  <p>
    <a href="/playground">‚Üê Playground</a>
  </p>
  <h1>Response Queue</h1>

  <button type="button" id="start">Start</button>
  <button type="button" id="stop">Stop</button>
</body>
</html>
