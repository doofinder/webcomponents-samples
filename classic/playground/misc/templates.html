<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Templates Playground</title>
  <script type="module">
    import '@dfwc/results';
    import '@dfwc/close';
    import '@dfwc/display';
    import '@dfwc/history';
    import '@dfwc/input';
    import '@dfwc/layer';
    import '@dfwc/pager';
    import '@dfwc/panel';
    import '@dfwc/range';
    import '@dfwc/suggestions';
    import '@dfwc/terms';
    import '@dfwc/total';

    import { addHelper, setLanguage, getLanguage, store, addTranslations } from '@dfwc/core';

    addHelper('json', function(value){
      return JSON.stringify(value, null, 2);
    });

    addTranslations({
      EN: {
        'df-pager.buttons.prev': 'Previous',
        'df-pager.buttons.next': 'Next',
      },
      ES: {
        'Brand': 'Marca', // df-panel is not subscribed to the context…
        'df-pager.buttons.prev': 'Anterior',
        'df-pager.buttons.next': 'Siguiente',
      }
    })

    document.querySelector('#lang').addEventListener('change', (event) => {
      setLanguage(event.target.value);
      // this doesn't work:
      const context = store.getContext('6a96504dc173514cab1e0198af92e6e9', 'eu1');
      context.search();
      console.log(`Current language is: ${getLanguage()}`);
    })

    document.querySelector('df-range').addEventListener('df-range:change', (event) => {
      console.log(event.detail);
    })
  </script>
</head>
<body>
  <a href="/playground">← Playground</a>
  <h1>Templates Playground</h1>

  <p>
    <label for="lang">Choose language</label>
    <select id="lang">
      <option value="EN">English</option>
      <option value="ES">Spanish</option>
    </select>
  </p>
  <div>
    <df-input-capture hashid="6a96504dc173514cab1e0198af92e6e9">
      <input type="search" placeholder="Type something to search…" style="width: 300px;margin-bottom: 1rem;" id="myInput">
      <button type="button" onclick="changeTemplate()">Change Template</button>
      <button type="button" onclick="changeCardTemplate()">Change Card Template</button>
    </df-input-capture>
  </div>

  <template id="displayTemplate">
    ${
      context.data.total > 0
      ? html`<p>${context.data.total} result${context.data.total > 1 ? 's' : ''} found (& < >)!</p>`
      : html`<p>Nothing to display…</p>`
    }

    <pre>${
      context.data.results
      ? this.$fn.json(context.data.results.map(r => r.title))
      : ''
    }</pre>

    <p>${context.labels.message}</p>

    <!--
      "this" can't be used if no explicit handle[WhateverEvent] method has been
      declared in the component!!!
    -->
    <button type="button" @click=${this}>Come on and break the app!</button>
  </template>

  <template id="cardTemplate">
    <div class="content">
      <p>Holaaaaaaa</p>
      <a class="title" id="cardLink" href="${context.data.link}" role="heading">${context.data.title}</a>
      <div class="description">${context.data.description}</div>
      <div class="pricing">
        <div class="price">${context.data.price}</div>
        <div class="sale-price">${context.data.sale_price}</div>
      </div>
    </div>
    <div class="media">
      <img src="//via.placeholder.com/300x225?text=Product%20Image" ?hidden=${!context.data.image_link}>
    </div>
  </template>

  <template id="panelTemplate">
    <div class="header">${context.labels.header ? `${context.labels.header} (custom)` : ''}</div>
    <div class="content">
      <slot></slot>
    </div>
  </template>

  <!--df-history hashid="6a96504dc173514cab1e0198af92e6e9" input="#myInput"></df-history-->

  <df-layer hashid="6a96504dc173514cab1e0198af92e6e9" id="layer">
    <df-total display-truncated="true"></df-total>
    <df-display template-context='{"labels": {"message": "Hola, mundo!"}}'></df-display>
    <df-close>
      <button type="button">Close something</button>
    </df-close>
    <df-panel>
      <df-suggestion-list></df-suggestion-list>
    </df-panel>
    <df-panel template="#panelTemplate" label="Some results" style="width: 800px;">
      <div>
        <df-pager previous-page-label="df-pager.buttons.prev" next-page-label="df-pager.buttons.next"></df-pager>
      </div>
      <df-results></df-results>
    </df-panel>
    <df-panel label="" style="width: 400px; padding: 2rem;">
      <df-range min="0" max="2000" currency></df-range>
      <df-range-filter field="best_price" currency></df-range-filter>
    </df-panel>
    <df-panel label="Brand" style="width: 400px;">
      <df-term-list field="brand"></df-term-list>
    </df-panel>
  </df-layer>

  <script>
    let changed = false;

    function changeTemplate() {
      if (!changed) {
        changed = true;

        function handleClick(e) {
          console.log('handled click from template!!!');
          display.renderTemplate = '#displayTemplate';
        }

        const display = document.querySelector('df-display');
        display.renderTemplate = function (html, context){
          return html`
            <p><button type="button" @click=${handleClick}>Click here to get your FREE ${context.data.total} results!</button></p>
          `;
        };
        display.addEventListener('click', function(e){
          console.log('handled click from the global context!!!');
        });
      }
    }

    let cardChanged = false;

    function changeCardTemplate() {
      if (!cardChanged) {
        cardChanged = true;
        const results = document.querySelector('df-results');
        results.itemTemplateId = '#cardTemplate';
      }
    }
  </script>
</body>
</html>
