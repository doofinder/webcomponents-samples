<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Core raw context usage</title>
  <link rel="stylesheet" href="/playground/assets/styles.css">
  <script type="module">
    import { store, clientPool } from '@dfwc/core';

    const subscriber = {
      stateChanged(topic, {state}) {
        // paint results if response changed and the processor was executed
        if (state.response.raw.modified === true) {
          const list = document.getElementById('resultsList');
          list.innerHTML = '';
          state.response.results.forEach(({title, price}) => {
            const child = document.createElement('li');
            child.innerHTML = `${title}: ${price}€`;
            list.appendChild(child);
          });
        }
      }
    };

    const context = store.getContext('6a96504dc173514cab1e0198af92e6e9', 'eu1', 'main-test');
    // configure a custom processor
    context.processor = function(response) {
      response.modified = true;
      return response;
    }
    context.subscribe('response', subscriber.stateChanged);

    const q = context.query;
    q.searchText('silla');
    q.addFilter('brand', 'JANE');
    q.addFilter('brand', 'RECARO');
    context.search();

    document.getElementById('apply').addEventListener('click', (e) => {
      const serverAddress = document.getElementById('serverAddress').value.trim();
      if (serverAddress) {
        clientPool.options = {serverAddress};
        context.search();
      } else {
        clientPool.options = {};
        context.search();
      }
    });

    window.context = context;
    window.clientPool = clientPool;
  </script>
</head>
<body>
  <p>
    <a href="/playground">← Playground</a>
  </p>
  <h1>Results</h1>

  <p>
    <label for="serverAddress" style="display: block; font-weight: bold; margin-bottom: .5em;">Server Address</label>
    <input type="text" id="serverAddress">
    <button type="button" id="apply">Search</button>
  </p>

  <ul id="resultsList">
  </ul>
</body>
</html>
